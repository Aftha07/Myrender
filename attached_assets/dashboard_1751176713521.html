<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Second Support Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: white;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .user-profile {
            padding: 20px;
            border-bottom: 1px solid #e5e5e5;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            margin-bottom: 10px;
            position: relative;
        }

        .user-avatar::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: #28a745;
            border: 2px solid white;
            border-radius: 50%;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 4px;
            color: #333;
        }

        .last-visit {
            font-size: 12px;
            color: #888;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            color: #666;
            text-decoration: none;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-item:hover {
            background: #f8f9fa;
        }

        .nav-item.active {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .nav-item-content {
            display: flex;
            align-items: center;
        }

        .nav-icon {
            width: 20px;
            margin-right: 12px;
            font-size: 16px;
        }

        .nav-arrow {
            font-size: 12px;
            color: #999;
            transition: transform 0.3s ease;
        }

        .nav-arrow.rotated {
            transform: rotate(90deg);
        }

        .submenu {
            display: none;
            background: #f8f9fa;
            border-left: 3px solid #4caf50;
            padding-left: 20px;
        }

        .submenu.show {
            display: block;
        }

        .submenu-item {
            padding: 10px 15px;
            margin: 0;
            border-right: none !important;
            font-size: 14px;
            cursor: pointer;
            background: transparent;
        }

        .submenu-item:hover {
            background: #e9ecef;
        }

        .submenu-item.active {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .support-btn {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: #00bcd4;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            flex: 1;
            padding: 0;
            background: #f5f5f5;
        }

        /* Header */
        .header {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid #e5e5e5;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #4caf50;
        }

        /* Customer Management Section */
        .customer-section {
            padding: 0;
        }

        .customer-header {
            background: #4caf50;
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .customer-title {
            font-size: 24px;
            font-weight: 600;
        }

        .btn-add-customer {
            background: #00bcd4;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
        }

        .btn-add-customer:hover {
            background: #00acc1;
        }

        .customer-content {
            background: white;
            padding: 30px;
        }

        /* Form Styles */
        .form-section {
            margin-bottom: 30px;
        }

        .form-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-weight: 500;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #4caf50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .required {
            color: #f44336;
        }

        /* Form Actions */
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e5e5e5;
        }

        .btn-cancel {
            background: #6c757d;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
        }

        .btn-save {
            background: #4caf50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
        }

        .btn-cancel:hover {
            background: #5a6268;
        }

        .btn-save:hover {
            background: #45a049;
        }

        /* Customer List */
        .customer-list-section {
            background: white;
            margin-top: 0;
            padding: 30px;
            border-top: 1px solid #e5e5e5;
        }

        .list-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }

        .customer-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 4px;
            overflow: hidden;
        }

        .customer-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            border-bottom: 1px solid #e5e5e5;
            color: #333;
            font-size: 14px;
        }

        .customer-table td {
            padding: 15px;
            border-bottom: 1px solid #e5e5e5;
            font-size: 14px;
            color: #666;
        }

        .customer-table tr:hover {
            background: #f8f9fa;
        }

        .no-customers {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 16px;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: #999;
            font-size: 12px;
            background: white;
            border-top: 1px solid #e5e5e5;
        }

        /* Hide/Show sections */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Success message */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
            display: none;
        }

        /* Phone number with country code styling */
        .phone-group {
            display: flex;
            gap: 10px;
        }

        .country-code-select {
            width: 120px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }

        .phone-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .country-code-select:focus,
        .phone-input:focus {
            outline: none;
            border-color: #4caf50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 1000;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .customer-content {
                padding: 20px;
            }

            .phone-group {
                flex-direction: column;
            }

            .country-code-select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="user-profile">
            <div class="user-avatar">مر</div>
            <div class="user-name">Welcome مرحبا</div>
            <div class="last-visit">Last Visit Date: 6 hours ago</div>
        </div>
        
        <nav class="nav-menu">
            <div class="nav-item" onclick="showSection('dashboard')">
                <div class="nav-item-content">
                    <span class="nav-icon">📊</span>
                    <span>Dashboard</span>
                </div>
            </div>
            <div class="nav-item" onclick="toggleSubmenu(this)">
                <div class="nav-item-content">
                    <span class="nav-icon">🔥</span>
                    <span>Sales</span>
                </div>
                <span class="nav-arrow">▶</span>
            </div>
            <div class="submenu" id="salesSubmenu">
                <div class="nav-item submenu-item active" onclick="showSection('customers')">
                    <div class="nav-item-content">
                        <span class="nav-icon">👥</span>
                        <span>Customer</span>
                    </div>
                </div>
                <div class="nav-item submenu-item" onclick="showSection('quotations')">
                    <div class="nav-item-content">
                        <span class="nav-icon">📝</span>
                        <span>Quotation</span>
                    </div>
                </div>
                <div class="nav-item submenu-item">
                    <div class="nav-item-content">
                        <span class="nav-icon">📄</span>
                        <span>Perform Invoice</span>
                    </div>
                </div>
                <div class="nav-item submenu-item">
                    <div class="nav-item-content">
                        <span class="nav-icon">🧾</span>
                        <span>Invoice</span>
                    </div>
                </div>
                <div class="nav-item submenu-item">
                    <div class="nav-item-content">
                        <span class="nav-icon">📋</span>
                        <span>Debit Note</span>
                    </div>
                </div>
                <div class="nav-item submenu-item">
                    <div class="nav-item-content">
                        <span class="nav-icon">📋</span>
                        <span>Credit Note</span>
                    </div>
                </div>
            </div>
            <div class="nav-item">
                <div class="nav-item-content">
                    <span class="nav-icon">🛒</span>
                    <span>Purchases</span>
                </div>
            </div>
            <div class="nav-item">
                <div class="nav-item-content">
                    <span class="nav-icon">🏷️</span>
                    <span>Products/Services</span>
                </div>
            </div>
        </nav>
        
        <button class="support-btn" onclick="logout()">🚪 Logout</button>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="logo">Second Support</div>
        </header>

        <!-- Dashboard Section -->
        <section id="dashboard" class="section">
            <div style="padding: 30px; text-align: center; color: #999; font-size: 18px;">
                Dashboard content will be displayed here
            </div>
            <div class="footer">
                All rights reserved © 2025 VOM
            </div>
        </section>

        <!-- Quotation Section -->
        <section id="quotations" class="section">
            <div class="customer-section">
                <div class="customer-header">
                    <h2 class="customer-title">Quotation Management</h2>
                    <button class="btn-add-customer" onclick="toggleQuotationForm()">+ Add New Quotation</button>
                </div>
                
                <div class="customer-content">
                    <!-- Add Quotation Form -->
                    <div id="quotationForm" class="form-section">
                        <h3 class="form-title">Add New Quotation</h3>
                        
                        <div id="quotationSuccessMessage" class="success-message"></div>
                        
                        <form onsubmit="saveQuotation(event)">
                            <div class="form-grid">
                                <!-- Reference ID -->
                                <div class="form-group">
                                    <label class="form-label" for="referenceId">Reference ID <span class="required">*</span></label>
                                    <input type="text" id="referenceId" class="form-input" required>
                                </div>

                                <!-- Customer -->
                                <div class="form-group">
                                    <label class="form-label" for="quotationCustomer">Customer <span class="required">*</span></label>
                                    <select id="quotationCustomer" class="form-select" required>
                                        <option value="">Please Select Customer</option>
                                    </select>
                                </div>

                                <!-- Issue Date -->
                                <div class="form-group">
                                    <label class="form-label" for="invoiceDate">Issue Date <span class="required">*</span></label>
                                    <input type="date" id="invoiceDate" class="form-input" required>
                                </div>

                                <!-- Due Date -->
                                <div class="form-group">
                                    <label class="form-label" for="dueDate">Due Date <span class="required">*</span></label>
                                    <input type="date" id="dueDate" class="form-input" required>
                                </div>

                                <!-- Description -->
                                <div class="form-group full-width">
                                    <label class="form-label" for="quotationDescription">Description (Optional)</label>
                                    <textarea id="quotationDescription" class="form-textarea" placeholder="Enter quotation description"></textarea>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn-cancel" onclick="clearQuotationForm()">Cancel</button>
                                <button type="submit" class="btn-save">Save Quotation</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Quotation List -->
                <div class="customer-list-section">
                    <h3 class="list-title">Quotation List</h3>
                    
                    <table class="customer-table">
                        <thead>
                            <tr>
                                <th>Reference ID</th>
                                <th>Customer</th>
                                <th>Issue Date</th>
                                <th>Due Date</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="quotationTableBody">
                            <tr>
                                <td colspan="6" class="no-customers">No quotations found. Add your first quotation above.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="footer">
                    All rights reserved © 2025 VOM
                </div>
            </div>
        </section>

        <!-- Customer Management Section -->
        <section id="customers" class="section active">
            <div class="customer-section">
                <div class="customer-header">
                    <h2 class="customer-title">Customer Management</h2>
                    <button class="btn-add-customer" onclick="toggleCustomerForm()">+ Add New Customer</button>
                </div>
                
                <div class="customer-content">
                    <!-- Add Customer Form -->
                    <div id="customerForm" class="form-section">
                        <h3 class="form-title">Add New Customer</h3>
                        
                        <div id="successMessage" class="success-message"></div>
                        
                        <form onsubmit="saveCustomer(event)">
                            <div class="form-grid">
                                <!-- Customer Name -->
                                <div class="form-group">
                                    <label class="form-label" for="customerName">Customer Name <span class="required">*</span></label>
                                    <input type="text" id="customerName" class="form-input" required>
                                </div>

                                <!-- Email Address -->
                                <div class="form-group">
                                    <label class="form-label" for="email">Email Address</label>
                                    <input type="email" id="email" class="form-input">
                                </div>

                                <!-- Phone Number with Country Code -->
                                <div class="form-group">
                                    <label class="form-label" for="phone">Phone Number</label>
                                    <div class="phone-group">
                                        <select id="countryCode" class="country-code-select">
                                            <option value="+1">+1 (US)</option>
                                            <option value="+44">+44 (UK)</option>
                                            <option value="+91">+91 (IN)</option>
                                            <option value="+86">+86 (CN)</option>
                                            <option value="+49">+49 (DE)</option>
                                            <option value="+33">+33 (FR)</option>
                                            <option value="+81">+81 (JP)</option>
                                            <option value="+7">+7 (RU)</option>
                                            <option value="+55">+55 (BR)</option>
                                            <option value="+61">+61 (AU)</option>
                                            <option value="+34">+34 (ES)</option>
                                            <option value="+39">+39 (IT)</option>
                                            <option value="+82">+82 (KR)</option>
                                            <option value="+52">+52 (MX)</option>
                                            <option value="+966">+966 (SA)</option>
                                            <option value="+971">+971 (AE)</option>
                                            <option value="+20">+20 (EG)</option>
                                        </select>
                                        <input type="tel" id="phone" class="phone-input" placeholder="Enter phone number">
                                    </div>
                                </div>

                                <!-- Company Name -->
                                <div class="form-group">
                                    <label class="form-label" for="company">Company Name</label>
                                    <input type="text" id="company" class="form-input">
                                </div>

                                <!-- Tax ID / VAT Number -->
                                <div class="form-group">
                                    <label class="form-label" for="taxId">Tax ID / VAT Number</label>
                                    <input type="text" id="taxId" class="form-input">
                                </div>

                                <!-- Opening Balance -->
                                <div class="form-group">
                                    <label class="form-label" for="openingBalance">Opening Balance</label>
                                    <input type="number" id="openingBalance" class="form-input" step="0.01" placeholder="0.00">
                                </div>

                                <!-- Address -->
                                <div class="form-group full-width">
                                    <label class="form-label" for="address">Address</label>
                                    <textarea id="address" class="form-textarea" placeholder="Enter full address"></textarea>
                                </div>

                                <!-- City -->
                                <div class="form-group">
                                    <label class="form-label" for="city">City</label>
                                    <input type="text" id="city" class="form-input">
                                </div>

                                <!-- Postal Code -->
                                <div class="form-group">
                                    <label class="form-label" for="postalCode">Postal Code</label>
                                    <input type="text" id="postalCode" class="form-input">
                                </div>

                                <!-- Country -->
                                <div class="form-group">
                                    <label class="form-label" for="country">Country</label>
                                    <input type="text" id="country" class="form-input">
                                </div>

                                <!-- Notes -->
                                <div class="form-group full-width">
                                    <label class="form-label" for="notes">Notes</label>
                                    <textarea id="notes" class="form-textarea" placeholder="Additional notes about the customer"></textarea>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn-cancel" onclick="clearForm()">Cancel</button>
                                <button type="submit" class="btn-save">Save Customer</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Customer List -->
                <div class="customer-list-section">
                    <h3 class="list-title">Customer List</h3>
                    
                    <table class="customer-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Company</th>
                                <th>Type</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="customerTableBody">
                            <tr>
                                <td colspan="6" class="no-customers">No customers found. Add your first customer above.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="footer">
                    All rights reserved © 2025 VOM
                </div>
            </div>
        </section>
    </main>

    <script>
        // Check authentication on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
        });

        async function checkAuth() {
            try {
                const response = await fetch('/api/user', {
                    credentials: 'same-origin',
                    cache: 'no-cache'
                });
                if (!response.ok) {
                    console.log('Authentication failed, redirecting to login');
                    window.location.replace('/login.html');
                    return;
                }
                const user = await response.json();
                console.log('User authenticated:', user.username);
                updateUserProfile(user);
            } catch (error) {
                console.error('Authentication error:', error);
                window.location.replace('/login.html');
            }
        }

        function updateUserProfile(user) {
            const userNameElement = document.querySelector('.user-name');
            const userAvatarElement = document.querySelector('.user-avatar');
            
            if (userNameElement) {
                userNameElement.textContent = `Welcome ${user.firstName || user.username}`;
            }
            
            if (userAvatarElement) {
                const initials = user.firstName && user.lastName 
                    ? `${user.firstName[0]}${user.lastName[0]}`.toUpperCase()
                    : user.username[0].toUpperCase();
                userAvatarElement.textContent = initials;
            }
            
            // Display last visit information
            const lastVisitElement = document.querySelector('.last-visit');
            if (lastVisitElement && user.lastVisit) {
                const lastVisit = new Date(user.lastVisit);
                const now = new Date();
                const diffInMinutes = Math.floor((now - lastVisit) / (1000 * 60));
                
                let lastVisitText;
                if (diffInMinutes < 1) {
                    lastVisitText = 'Just now';
                } else if (diffInMinutes < 60) {
                    lastVisitText = `${diffInMinutes} minute${diffInMinutes > 1 ? 's' : ''} ago`;
                } else if (diffInMinutes < 1440) {
                    const hours = Math.floor(diffInMinutes / 60);
                    lastVisitText = `${hours} hour${hours > 1 ? 's' : ''} ago`;
                } else {
                    const days = Math.floor(diffInMinutes / 1440);
                    if (days === 1) {
                        lastVisitText = 'Yesterday';
                    } else if (days < 7) {
                        lastVisitText = `${days} days ago`;
                    } else {
                        lastVisitText = lastVisit.toLocaleDateString();
                    }
                }
                
                lastVisitElement.textContent = `Last visit: ${lastVisitText}`;
            } else if (lastVisitElement) {
                lastVisitElement.textContent = 'First time login';
            }
        }

        async function logout() {
            try {
                await fetch('/api/logout', { method: 'POST' });
                window.location.href = '/login.html';
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = '/login.html';
            }
        }

        // Data storage
        let customers = [];
        let quotations = [];

        // Show/Hide sections
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked nav item
            event.target.closest('.nav-item').classList.add('active');

            // Update customer dropdown in quotation form if quotations section is shown
            if (sectionId === 'quotations') {
                updateCustomerDropdown();
            }
        }

        // Toggle customer form visibility
        function toggleCustomerForm() {
            const form = document.getElementById('customerForm');
            if (form.style.display === 'none') {
                form.style.display = 'block';
            } else {
                form.style.display = 'none';
            }
        }

        // Save customer
        function saveCustomer(event) {
            event.preventDefault();
            
            const countryCode = document.getElementById('countryCode').value;
            const phoneNumber = document.getElementById('phone').value;
            const fullPhone = phoneNumber ? `${countryCode} ${phoneNumber}` : '';
            
            const customer = {
                id: Date.now(),
                name: document.getElementById('customerName').value,
                email: document.getElementById('email').value,
                phone: fullPhone,
                company: document.getElementById('company').value,
                taxId: document.getElementById('taxId').value,
                openingBalance: document.getElementById('openingBalance').value,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value,
                postalCode: document.getElementById('postalCode').value,
                country: document.getElementById('country').value,
                notes: document.getElementById('notes').value
            };

            customers.push(customer);
            updateCustomerTable();
            clearForm();
            showSuccessMessage('Customer saved successfully!');
        }

        // Clear form
        function clearForm() {
            document.querySelector('#customerForm form').reset();
            document.getElementById('countryCode').value = '+1'; // Reset to default
            document.getElementById('successMessage').style.display = 'none';
        }

        // Show success message
        function showSuccessMessage(message) {
            const messageDiv = document.getElementById('successMessage');
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }

        // Update customer table
        function updateCustomerTable() {
            const tbody = document.getElementById('customerTableBody');
            
            if (customers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="no-customers">No customers found. Add your first customer above.</td></tr>';
                return;
            }

            tbody.innerHTML = customers.map(customer => `
                <tr>
                    <td>${customer.name}</td>
                    <td>${customer.email || '-'}</td>
                    <td>${customer.phone || '-'}</td>
                    <td>${customer.company || '-'}</td>
                    <td>Individual</td>
                    <td>
                        <button class="btn-edit" onclick="editCustomer(${customer.id})" style="background: #ffc107; color: #212529; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer; font-size: 12px; margin-right: 5px;">Edit</button>
                        <button class="btn-delete" onclick="deleteCustomer(${customer.id})" style="background: #dc3545; color: white; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        // Edit customer
        function editCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (customer) {
                document.getElementById('customerName').value = customer.name;
                document.getElementById('email').value = customer.email || '';
                
                // Split phone number to extract country code and number
                if (customer.phone) {
                    const phoneMatch = customer.phone.match(/^(\+\d+)\s(.+)$/);
                    if (phoneMatch) {
                        document.getElementById('countryCode').value = phoneMatch[1];
                        document.getElementById('phone').value = phoneMatch[2];
                    } else {
                        document.getElementById('phone').value = customer.phone;
                    }
                }
                
                document.getElementById('company').value = customer.company || '';
                document.getElementById('taxId').value = customer.taxId || '';
                document.getElementById('openingBalance').value = customer.openingBalance || '';
                document.getElementById('address').value = customer.address || '';
                document.getElementById('city').value = customer.city || '';
                document.getElementById('postalCode').value = customer.postalCode || '';
                document.getElementById('country').value = customer.country || '';
                document.getElementById('notes').value = customer.notes || '';
                
                document.getElementById('customerForm').style.display = 'block';
                
                // Remove the customer from array (will be re-added when saved)
                customers = customers.filter(c => c.id !== id);
                updateCustomerTable();
            }
        }

        // Delete customer
        function deleteCustomer(id) {
            if (confirm('Are you sure you want to delete this customer?')) {
                customers = customers.filter(c => c.id !== id);
                updateCustomerTable();
                showSuccessMessage('Customer deleted successfully!');
            }
        }

        // Toggle submenu
        function toggleSubmenu(element) {
            const arrow = element.querySelector('.nav-arrow');
            const submenu = document.getElementById('salesSubmenu');
            
            if (arrow && submenu) {
                if (submenu.classList.contains('show')) {
                    submenu.classList.remove('show');
                    arrow.classList.remove('rotated');
                } else {
                    submenu.classList.add('show');
                    arrow.classList.add('rotated');
                }
            }
        }

        // Quotation management functions
        function toggleQuotationForm() {
            const form = document.getElementById('quotationForm');
            if (form.style.display === 'none') {
                form.style.display = 'block';
                updateCustomerDropdown();
            } else {
                form.style.display = 'none';
            }
        }

        function updateCustomerDropdown() {
            const dropdown = document.getElementById('quotationCustomer');
            dropdown.innerHTML = '<option value="">Please Select Customer</option>';
            
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = customer.name;
                dropdown.appendChild(option);
            });
        }

        function saveQuotation(event) {
            event.preventDefault();
            
            const quotation = {
                id: Date.now(),
                referenceId: document.getElementById('referenceId').value,
                customerId: document.getElementById('quotationCustomer').value,
                customerName: customers.find(c => c.id == document.getElementById('quotationCustomer').value)?.name || '',
                invoiceDate: document.getElementById('invoiceDate').value,
                dueDate: document.getElementById('dueDate').value,
                description: document.getElementById('quotationDescription').value
            };

            quotations.push(quotation);
            updateQuotationTable();
            clearQuotationForm();
            showQuotationSuccessMessage('Quotation saved successfully!');
        }

        function clearQuotationForm() {
            document.querySelector('#quotationForm form').reset();
            document.getElementById('quotationSuccessMessage').style.display = 'none';
        }

        function showQuotationSuccessMessage(message) {
            const messageDiv = document.getElementById('quotationSuccessMessage');
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }

        function updateQuotationTable() {
            const tbody = document.getElementById('quotationTableBody');
            
            if (quotations.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="no-customers">No quotations found. Add your first quotation above.</td></tr>';
                return;
            }

            tbody.innerHTML = quotations.map(quotation => `
                <tr>
                    <td>${quotation.referenceId}</td>
                    <td>${quotation.customerName || '-'}</td>
                    <td>${quotation.invoiceDate}</td>
                    <td>${quotation.dueDate}</td>
                    <td>${quotation.description || '-'}</td>
                    <td>
                        <button class="btn-edit" onclick="editQuotation(${quotation.id})" style="background: #ffc107; color: #212529; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer; font-size: 12px; margin-right: 5px;">Edit</button>
                        <button class="btn-delete" onclick="deleteQuotation(${quotation.id})" style="background: #dc3545; color: white; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function editQuotation(id) {
            const quotation = quotations.find(q => q.id === id);
            if (quotation) {
                document.getElementById('referenceId').value = quotation.referenceId;
                document.getElementById('quotationCustomer').value = quotation.customerId;
                document.getElementById('invoiceDate').value = quotation.invoiceDate;
                document.getElementById('dueDate').value = quotation.dueDate;
                document.getElementById('quotationDescription').value = quotation.description || '';
                
                document.getElementById('quotationForm').style.display = 'block';
                
                quotations = quotations.filter(q => q.id !== id);
                updateQuotationTable();
            }
        }

        function deleteQuotation(id) {
            if (confirm('Are you sure you want to delete this quotation?')) {
                quotations = quotations.filter(q => q.id !== id);
                updateQuotationTable();
                showQuotationSuccessMessage('Quotation deleted successfully!');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCustomerTable();
            updateQuotationTable();
            
            // Set default dates to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('invoiceDate').value = today;
            
            // Set due date to 30 days from today
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 30);
            document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
        });
    </script>
</body>
</html>